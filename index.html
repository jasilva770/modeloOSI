<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modelos TCP/IP y OSI - Animaci√≥n Visual</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .animation-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
        }

        .model-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .model-btn {
            padding: 15px 40px;
            font-size: 1.2em;
            font-weight: bold;
            border: 3px solid #3b82f6;
            background: white;
            color: #3b82f6;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .model-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }

        .model-btn.active {
            background: #3b82f6;
            color: white;
        }

        .animation-area {
            display: none;
        }

        .animation-area.active {
            display: block;
        }

        /* NUEVA SECCI√ìN DE EXPLICACI√ìN GRANDE */
        .explanation-box {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            min-height: 250px;
        }

        .step-number {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.9; }
        }

        .explanation-title {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .explanation-text {
            font-size: 1.5em;
            line-height: 1.8;
            text-align: center;
            margin-bottom: 20px;
        }

        .what-happens {
            background: rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            margin-top: 20px;
        }

        .what-happens-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .what-happens-content {
            font-size: 1.2em;
            line-height: 1.6;
        }

        /* VISUALIZACI√ìN MEJORADA */
        .visual-demo {
            background: #f8fafc;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            min-height: 400px;
            position: relative;
            overflow: hidden;
        }

        .demo-title {
            text-align: center;
            font-size: 1.8em;
            color: #1e293b;
            margin-bottom: 30px;
            font-weight: bold;
        }

        .visual-flow {
            display: flex;
            justify-content: space-around;
            align-items: center;
            gap: 30px;
            position: relative;
        }

        .flow-device {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            width: 180px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .flow-device-icon {
            font-size: 5em;
            margin-bottom: 15px;
        }

        .flow-device-name {
            font-size: 1.3em;
            font-weight: bold;
        }

        .flow-center {
            flex: 1;
            position: relative;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* PAQUETE DE DATOS MEJORADO */
        .data-visual {
            background: white;
            border: 4px solid #3b82f6;
            border-radius: 20px;
            padding: 30px;
            min-width: 400px;
            box-shadow: 0 10px 40px rgba(59, 130, 246, 0.4);
            position: relative;
        }

        .data-core {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            color: white;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(251, 191, 36, 0.5);
        }

        .data-layer {
            background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 5px solid #3b82f6;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(-30px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .data-layer-title {
            font-weight: bold;
            color: #1e293b;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .data-layer-info {
            color: #475569;
            font-size: 0.95em;
        }

        /* FLECHAS ANIMADAS */
        .arrow-container {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .animated-arrow {
            position: absolute;
            font-size: 4em;
            animation: moveArrow 2s infinite;
            display: none;
        }

        .animated-arrow.show {
            display: block;
        }

        @keyframes moveArrow {
            0%, 100% { transform: translateX(0); opacity: 0.5; }
            50% { transform: translateX(20px); opacity: 1; }
        }

        .arrow-right {
            left: 25%;
            top: 45%;
        }

        .arrow-left {
            right: 25%;
            top: 45%;
            animation: moveArrowLeft 2s infinite;
        }

        @keyframes moveArrowLeft {
            0%, 100% { transform: translateX(0) scaleX(-1); opacity: 0.5; }
            50% { transform: translateX(-20px) scaleX(-1); opacity: 1; }
        }

        /* COMPARACI√ìN VISUAL */
        .comparison-visual {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .before-after {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .before-after h4 {
            text-align: center;
            font-size: 1.3em;
            margin-bottom: 15px;
            color: #3b82f6;
        }

        .before-after-content {
            font-size: 1.1em;
            line-height: 1.6;
            color: #475569;
        }

        /* CONTROLES */
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .control-btn {
            padding: 20px 45px;
            font-size: 1.3em;
            font-weight: bold;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }

        .btn-next {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-next:hover:not(:disabled) {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.5);
        }

        .btn-prev {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            color: white;
        }

        .btn-prev:hover:not(:disabled) {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(100, 116, 139, 0.5);
        }

        .btn-reset {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .btn-reset:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(239, 68, 68, 0.5);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* INDICADOR DE PROGRESO */
        .progress-indicator {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
        }

        .progress-dot {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.3s ease;
            border: 3px solid #cbd5e1;
        }

        .progress-dot.completed {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-color: #059669;
            transform: scale(1.1);
        }

        .progress-dot.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border-color: #2563eb;
            transform: scale(1.3);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.5);
            animation: bounce-dot 1s infinite;
        }

        @keyframes bounce-dot {
            0%, 100% { transform: scale(1.3) translateY(0); }
            50% { transform: scale(1.3) translateY(-5px); }
        }

        @media (max-width: 1200px) {
            .visual-flow {
                flex-direction: column;
            }

            .comparison-visual {
                grid-template-columns: 1fr;
            }

            .data-visual {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåê Simulador Visual: Modelos OSI y TCP/IP</h1>

        <div class="animation-section">
            <div class="model-selector">
                <button class="model-btn active" onclick="selectModel('osi')">
                    üìö Modelo OSI (7 Capas)
                </button>
                <button class="model-btn" onclick="selectModel('tcp')">
                    üåç Modelo TCP/IP (4 Capas)
                </button>
            </div>

            <!-- Animaci√≥n OSI -->
            <div id="osi-animation" class="animation-area active">
                <!-- EXPLICACI√ìN GRANDE -->
                <div class="explanation-box" id="osi-explanation">
                    <div class="step-number" id="osi-step-num">üöÄ INICIO</div>
                    <div class="explanation-title" id="osi-expl-title">
                        Presiona "Siguiente Paso" para comenzar
                    </div>
                    <div class="explanation-text" id="osi-expl-text">
                        Vamos a enviar un EMAIL desde tu computadora al servidor de Gmail. 
                        Ver√°s c√≥mo el mensaje "Hola Mundo" pasa por las 7 capas del Modelo OSI.
                    </div>
                    <div class="what-happens" id="osi-what-happens" style="display: none;">
                        <div class="what-happens-title">‚öôÔ∏è ¬øQu√© sucede en esta capa?</div>
                        <div class="what-happens-content" id="osi-what-content"></div>
                    </div>
                </div>

                <!-- INDICADOR DE PROGRESO -->
                <div class="progress-indicator" id="osi-progress"></div>

                <!-- VISUALIZACI√ìN -->
                <div class="visual-demo">
                    <div class="demo-title" id="osi-demo-title">üì§ Enviando Email</div>
                    <div class="visual-flow">
                        <div class="flow-device">
                            <div class="flow-device-icon">üíª</div>
                            <div class="flow-device-name">Tu PC</div>
                        </div>

                        <div class="flow-center">
                            <div class="arrow-container">
                                <div class="animated-arrow arrow-right" id="osi-arrow-right">‚û°Ô∏è</div>
                            </div>
                            <div class="data-visual" id="osi-data-visual">
                                <div class="data-core">üìß "Hola Mundo"</div>
                                <div id="osi-layers-wrap"></div>
                            </div>
                        </div>

                        <div class="flow-device">
                            <div class="flow-device-icon">üñ•Ô∏è</div>
                            <div class="flow-device-name">Gmail</div>
                        </div>
                    </div>

                    <!-- COMPARACI√ìN ANTES/DESPU√âS -->
                    <div class="comparison-visual" id="osi-comparison" style="display: none;">
                        <div class="before-after">
                            <h4>üî¥ ANTES de esta capa</h4>
                            <div class="before-after-content" id="osi-before"></div>
                        </div>
                        <div class="before-after">
                            <h4>üü¢ DESPU√âS de esta capa</h4>
                            <div class="before-after-content" id="osi-after"></div>
                        </div>
                    </div>
                </div>

                <div class="controls">
                    <button class="control-btn btn-prev" onclick="previousStep('osi')" id="osi-prev" disabled>
                        ‚¨ÖÔ∏è Anterior
                    </button>
                    <button class="control-btn btn-reset" onclick="resetAnimation('osi')">
                        üîÑ Reiniciar
                    </button>
                    <button class="control-btn btn-next" onclick="nextStep('osi')" id="osi-next">
                        Siguiente ‚û°Ô∏è
                    </button>
                </div>
            </div>

            <!-- Animaci√≥n TCP/IP -->
            <div id="tcp-animation" class="animation-area">
                <!-- EXPLICACI√ìN GRANDE -->
                <div class="explanation-box" id="tcp-explanation">
                    <div class="step-number" id="tcp-step-num">üöÄ INICIO</div>
                    <div class="explanation-title" id="tcp-expl-title">
                        Presiona "Siguiente Paso" para comenzar
                    </div>
                    <div class="explanation-text" id="tcp-expl-text">
                        Vamos a enviar un EMAIL desde tu computadora al servidor de Gmail. 
                        Ver√°s c√≥mo el mensaje "Hola Mundo" pasa por las 4 capas del Modelo TCP/IP.
                    </div>
                    <div class="what-happens" id="tcp-what-happens" style="display: none;">
                        <div class="what-happens-title">‚öôÔ∏è ¬øQu√© sucede en esta capa?</div>
                        <div class="what-happens-content" id="tcp-what-content"></div>
                    </div>
                </div>

                <!-- INDICADOR DE PROGRESO -->
                <div class="progress-indicator" id="tcp-progress"></div>

                <!-- VISUALIZACI√ìN -->
                <div class="visual-demo">
                    <div class="demo-title" id="tcp-demo-title">üì§ Enviando Email</div>
                    <div class="visual-flow">
                        <div class="flow-device">
                            <div class="flow-device-icon">üíª</div>
                            <div class="flow-device-name">Tu PC</div>
                        </div>

                        <div class="flow-center">
                            <div class="arrow-container">
                                <div class="animated-arrow arrow-right" id="tcp-arrow-right">‚û°Ô∏è</div>
                            </div>
                            <div class="data-visual" id="tcp-data-visual">
                                <div class="data-core">üìß "Hola Mundo"</div>
                                <div id="tcp-layers-wrap"></div>
                            </div>
                        </div>

                        <div class="flow-device">
                            <div class="flow-device-icon">üñ•Ô∏è</div>
                            <div class="flow-device-name">Gmail</div>
                        </div>
                    </div>

                    <!-- COMPARACI√ìN ANTES/DESPU√âS -->
                    <div class="comparison-visual" id="tcp-comparison" style="display: none;">
                        <div class="before-after">
                            <h4>üî¥ ANTES de esta capa</h4>
                            <div class="before-after-content" id="tcp-before"></div>
                        </div>
                        <div class="before-after">
                            <h4>üü¢ DESPU√âS de esta capa</h4>
                            <div class="before-after-content" id="tcp-after"></div>
                        </div>
                    </div>
                </div>

                <div class="controls">
                    <button class="control-btn btn-prev" onclick="previousStep('tcp')" id="tcp-prev" disabled>
                        ‚¨ÖÔ∏è Anterior
                    </button>
                    <button class="control-btn btn-reset" onclick="resetAnimation('tcp')">
                        üîÑ Reiniciar
                    </button>
                    <button class="control-btn btn-next" onclick="nextStep('tcp')" id="tcp-next">
                        Siguiente ‚û°Ô∏è
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const osiSteps = [
            {
                num: 'CAPA 7',
                title: 'üì± APLICACI√ìN - Tu programa de Email',
                text: 'Escribes "Hola Mundo" en Gmail y presionas ENVIAR. Tu navegador usa el protocolo SMTP para preparar el mensaje.',
                what: '‚úÖ El cliente de email toma tu mensaje<br>‚úÖ A√±ade informaci√≥n del remitente y destinatario<br>‚úÖ Prepara el mensaje para enviarlo',
                layerName: 'Capa Aplicaci√≥n',
                layerInfo: 'Protocolo SMTP - Puerto 587',
                before: 'Solo tienes el texto: "Hola Mundo"',
                after: 'Ahora tiene formato de email con remitente, destinatario, asunto, etc.'
            },
            {
                num: 'CAPA 6',
                title: 'üîí PRESENTACI√ìN - Cifrado y Formato',
                text: 'Tu mensaje se CIFRA con SSL/TLS para que nadie pueda leerlo durante el viaje. Tambi√©n se convierte a formato binario.',
                what: 'üîê Se cifra el mensaje completo con SSL/TLS<br>‚úÖ Se comprime para que ocupe menos<br>‚úÖ Se convierte a formato binario (0s y 1s)',
                layerName: 'Capa Presentaci√≥n',
                layerInfo: 'Cifrado SSL/TLS + Compresi√≥n',
                before: 'Email en texto claro que cualquiera podr√≠a leer',
                after: 'Email CIFRADO imposible de leer sin la clave correcta'
            },
            {
                num: 'CAPA 5',
                title: 'üí¨ SESI√ìN - Establece la Conversaci√≥n',
                text: 'Se crea una "sesi√≥n" o "conversaci√≥n" con el servidor de Gmail. Esto mantiene la conexi√≥n activa mientras se env√≠a todo.',
                what: '‚úÖ Se establece una conexi√≥n con Gmail<br>‚úÖ Se sincroniza el inicio y fin de la comunicaci√≥n<br>‚úÖ Controla que no se pierda la conexi√≥n',
                layerName: 'Capa Sesi√≥n',
                layerInfo: 'Control de Sesi√≥n Activa',
                before: 'Datos cifrados sin conexi√≥n establecida',
                after: 'Conexi√≥n activa y sincronizada con el servidor de Gmail'
            },
            {
                num: 'CAPA 4',
                title: 'üì¶ TRANSPORTE - Divide en Paquetes',
                text: 'TCP divide tu email en SEGMENTOS peque√±os (como cortar una pizza). A√±ade n√∫meros de secuencia para poder reconstruirlo despu√©s.',
                what: '‚úÇÔ∏è Divide el email en segmentos peque√±os<br>üî¢ A√±ade n√∫meros de secuencia (1, 2, 3...)<br>‚úÖ Garantiza que lleguen todos y en orden',
                layerName: 'Capa Transporte',
                layerInfo: 'TCP - Segmentos numerados',
                before: 'Un mensaje grande y pesado',
                after: 'M√∫ltiples segmentos peque√±os numerados: [1/5], [2/5], [3/5], [4/5], [5/5]'
            },
            {
                num: 'CAPA 3',
                title: 'üó∫Ô∏è RED - A√±ade Direcciones IP',
                text: 'Se a√±aden las DIRECCIONES IP. Como poner la direcci√≥n en un sobre: "De: 192.168.1.5 Para: 172.217.12.109". Los routers usan esto para saber d√≥nde enviarlo.',
                what: 'üìç A√±ade tu direcci√≥n IP (192.168.1.5)<br>üìç A√±ade la IP de Gmail (172.217.12.109)<br>üó∫Ô∏è Los routers usan esto para encontrar el camino',
                layerName: 'Capa Red',
                layerInfo: 'IP: 192.168.1.5 ‚Üí 172.217.12.109',
                before: 'Segmentos sin direcci√≥n de destino',
                after: 'Paquetes IP con origen y destino claros - listos para viajar por Internet'
            },
            {
                num: 'CAPA 2',
                title: 'üîå ENLACE - A√±ade Direcciones MAC',
                text: 'Se a√±aden direcciones MAC (f√≠sicas) de tu tarjeta de red y del router. Tambi√©n se a√±ade detecci√≥n de errores (CRC).',
                what: 'üè∑Ô∏è A√±ade direcci√≥n MAC de tu tarjeta de red<br>üè∑Ô∏è A√±ade MAC del router<br>üõ°Ô∏è A√±ade c√≥digo de detecci√≥n de errores',
                layerName: 'Capa Enlace de Datos',
                layerInfo: 'Ethernet - MAC + CRC',
                before: 'Paquetes IP',
                after: 'TRAMAS Ethernet con direcciones f√≠sicas y protecci√≥n contra errores'
            },
            {
                num: 'CAPA 1',
                title: '‚ö° F√çSICA - ¬°Viajando!',
                text: 'Los datos se convierten en SE√ëALES EL√âCTRICAS (0 = 0 voltios, 1 = 5 voltios) que viajan por el cable Ethernet o se√±ales de radio si usas WiFi. ¬°Tu email est√° viajando!',
                what: '‚ö° Los bits (0 y 1) se convierten en se√±ales el√©ctricas<br>üì° Viajan por cable Ethernet o ondas WiFi<br>üöÄ ¬°Los datos est√°n f√≠sicamente en movimiento!',
                layerName: 'Capa F√≠sica',
                layerInfo: 'Se√±ales: 01011010110...',
                before: 'Tramas digitales en la memoria',
                after: '¬°SE√ëALES EL√âCTRICAS viajando a la velocidad de la luz por los cables!'
            }
        ];

        const tcpSteps = [
            {
                num: 'CAPA 4',
                title: 'üì± APLICACI√ìN - Todo en Uno',
                text: 'Tu programa prepara el email, lo cifra con SSL/TLS y usa SMTP. Esta capa hace TODO lo que en OSI hac√≠an las capas 7, 6 y 5.',
                what: 'üìù Preparaci√≥n del email (SMTP)<br>üîê Cifrado completo (SSL/TLS)<br>üí¨ Establece sesi√≥n con Gmail',
                layerName: 'Capa Aplicaci√≥n',
                layerInfo: 'SMTP + SSL/TLS + Sesi√≥n',
                before: 'Texto simple: "Hola Mundo"',
                after: 'Email completo, cifrado y con sesi√≥n establecida con Gmail'
            },
            {
                num: 'CAPA 3',
                title: 'üì¶ TRANSPORTE - Segmentaci√≥n',
                text: 'TCP divide tu email en SEGMENTOS peque√±os, a√±ade n√∫meros de secuencia y garantiza que lleguen todos. Control total de la entrega.',
                what: '‚úÇÔ∏è Divide en segmentos numerados<br>‚úÖ Control de flujo y congesti√≥n<br>üîÑ Reenv√≠a si algo se pierde',
                layerName: 'Capa Transporte',
                layerInfo: 'TCP Puerto 587 - Segmentos',
                before: 'Email grande y completo',
                after: 'Segmentos peque√±os y numerados [1/5] [2/5] [3/5] [4/5] [5/5]'
            },
            {
                num: 'CAPA 2',
                title: 'üåê INTERNET - Enrutamiento',
                text: 'Se a√±aden direcciones IP (origen y destino). Los ROUTERS de Internet usan estas direcciones para enviar los paquetes por el mejor camino.',
                what: 'üìç A√±ade IPs: 192.168.1.5 ‚Üí 172.217.12.109<br>üó∫Ô∏è Los routers calculan la mejor ruta<br>üö¶ Pasa por m√∫ltiples routers hasta Gmail',
                layerName: 'Capa Internet',
                layerInfo: 'Protocolo IP + Enrutamiento',
                before: 'Segmentos sin direcci√≥n de destino',
                after: 'PAQUETES IP listos para viajar por toda Internet con direcciones completas'
            },
            {
                num: 'CAPA 1',
                title: '‚ö° ACCESO A RED - Transmisi√≥n F√≠sica',
                text: 'Se crean tramas Ethernet con MACs, se a√±ade detecci√≥n de errores y ¬°se env√≠an como SE√ëALES EL√âCTRICAS por el cable o WiFi!',
                what: 'üè∑Ô∏è A√±ade direcciones MAC f√≠sicas<br>üõ°Ô∏è Control de errores (CRC)<br>‚ö° Convierte a se√±ales el√©ctricas u ondas de radio',
                layerName: 'Capa Acceso a Red',
                layerInfo: 'Ethernet + WiFi + Se√±ales',
                before: 'Paquetes IP digitales',
                after: '¬°SE√ëALES F√çSICAS viajando por cables o WiFi a la velocidad de la luz!'
            }
        ];

        let state = {
            osi: { step: 0, maxSteps: 7 },
            tcp: { step: 0, maxSteps: 4 }
        };

        function initProgress(model) {
            const steps = model === 'osi' ? 7 : 4;
            const progressEl = document.getElementById(`${model}-progress`);
            progressEl.innerHTML = '';
            
            for (let i = 1; i <= steps; i++) {
                progressEl.innerHTML += `<div class="progress-dot" id="${model}-dot-${i}">${i}</div>`;
            }
        }

        function selectModel(model) {
            document.querySelectorAll('.model-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            document.querySelectorAll('.animation-area').forEach(area => area.classList.remove('active'));
            document.getElementById(`${model}-animation`).classList.add('active');
        }

        function updateVisual(model, stepIndex) {
            const steps = model === 'osi' ? osiSteps : tcpSteps;
            const step = steps[stepIndex];

            // Actualizar explicaci√≥n
            document.getElementById(`${model}-step-num`).textContent = step.num;
            document.getElementById(`${model}-expl-title`).textContent = step.title;
            document.getElementById(`${model}-expl-text`).textContent = step.text;
            
            document.getElementById(`${model}-what-happens`).style.display = 'block';
            document.getElementById(`${model}-what-content`).innerHTML = step.what;

            // Actualizar visualizaci√≥n de capas
            const layersWrap = document.getElementById(`${model}-layers-wrap`);
            layersWrap.innerHTML = '';
            for (let i = 0; i <= stepIndex; i++) {
                layersWrap.innerHTML += `
                    <div class="data-layer">
                        <div class="data-layer-title">${steps[i].layerName}</div>
                        <div class="data-layer-info">${steps[i].layerInfo}</div>
                    </div>
                `;
            }

            // Mostrar flecha animada
            document.getElementById(`${model}-arrow-right`).classList.add('show');

            // Mostrar comparaci√≥n antes/despu√©s
            document.getElementById(`${model}-comparison`).style.display = 'grid';
            document.getElementById(`${model}-before`).innerHTML = step.before;
            document.getElementById(`${model}-after`).innerHTML = step.after;

            // Actualizar indicador de progreso
            for (let i = 1; i <= steps.length; i++) {
                const dot = document.getElementById(`${model}-dot-${i}`);
                dot.classList.remove('active', 'completed');
                if (i < stepIndex + 1) {
                    dot.classList.add('completed');
                } else if (i === stepIndex + 1) {
                    dot.classList.add('active');
                }
            }
        }

        function nextStep(model) {
            const steps = model === 'osi' ? osiSteps : tcpSteps;
            const currentStep = state[model].step;

            if (currentStep < steps.length) {
                updateVisual(model, currentStep);
                state[model].step++;

                document.getElementById(`${model}-prev`).disabled = false;
                
                if (state[model].step >= steps.length) {
                    document.getElementById(`${model}-next`).disabled = true;
                }
            }
        }

        function previousStep(model) {
            const steps = model === 'osi' ? osiSteps : tcpSteps;
            let currentStep = state[model].step;

            if (currentStep > 0) {
                state[model].step--;
                currentStep = state[model].step;

                if (currentStep > 0) {
                    updateVisual(model, currentStep - 1);
                } else {
                    // Volver al estado inicial
                    document.getElementById(`${model}-step-num`).textContent = 'üöÄ INICIO';
                    document.getElementById(`${model}-expl-title`).textContent = 'Presiona "Siguiente Paso" para comenzar';
                    document.getElementById(`${model}-expl-text`).textContent = `Vamos a enviar un EMAIL desde tu computadora al servidor de Gmail. Ver√°s c√≥mo el mensaje "Hola Mundo" pasa por las ${steps.length} capas del Modelo ${model.toUpperCase()}.`;
                    document.getElementById(`${model}-what-happens`).style.display = 'none';
                    document.getElementById(`${model}-layers-wrap`).innerHTML = '';
                    document.getElementById(`${model}-arrow-right`).classList.remove('show');
                    document.getElementById(`${model}-comparison`).style.display = 'none';
                    
                    // Resetear indicador de progreso
                    for (let i = 1; i <= steps.length; i++) {
                        const dot = document.getElementById(`${model}-dot-${i}`);
                        dot.classList.remove('active', 'completed');
                    }
                }

                document.getElementById(`${model}-next`).disabled = false;
                
                if (currentStep === 0) {
                    document.getElementById(`${model}-prev`).disabled = true;
                }
            }
        }

        function resetAnimation(model) {
            state[model].step = 0;
            const steps = model === 'osi' ? osiSteps : tcpSteps;

            document.getElementById(`${model}-step-num`).textContent = 'üöÄ INICIO';
            document.getElementById(`${model}-expl-title`).textContent = 'Presiona "Siguiente Paso" para comenzar';
            document.getElementById(`${model}-expl-text`).textContent = `Vamos a enviar un EMAIL desde tu computadora al servidor de Gmail. Ver√°s c√≥mo el mensaje "Hola Mundo" pasa por las ${steps.length} capas del Modelo ${model.toUpperCase()}.`;
            document.getElementById(`${model}-what-happens`).style.display = 'none';
            document.getElementById(`${model}-layers-wrap`).innerHTML = '';
            document.getElementById(`${model}-arrow-right`).classList.remove('show');
            document.getElementById(`${model}-comparison`).style.display = 'none';

            document.getElementById(`${model}-prev`).disabled = true;
            document.getElementById(`${model}-next`).disabled = false;

            // Resetear indicador de progreso
            for (let i = 1; i <= steps.length; i++) {
                const dot = document.getElementById(`${model}-dot-${i}`);
                dot.classList.remove('active', 'completed');
            }
        }

        window.addEventListener('DOMContentLoaded', function() {
            initProgress('osi');
            initProgress('tcp');
        });
    </script>
</body>
</html>